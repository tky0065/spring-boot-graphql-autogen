<?xml version="1.0" encoding="UTF-8"?>
<!--
  Configuration Maven settings.xml pour Maven Central avec le nouveau Central Portal
  Phase 10 : Publication et maintenance - Configuration Maven Central (mise à jour 2025)
  
  Utilise le nouveau Central Portal de Sonatype avec user tokens
  Documentation: https://central.sonatype.org/publish/
-->
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 
          https://maven.apache.org/xsd/settings-1.0.0.xsd">

    <!-- Serveurs avec credentials pour déploiement -->
    <servers>
        <!-- Central Portal avec user token (nouveau) -->
        <server>
            <id>central</id>
            <username>${env.CENTRAL_TOKEN_USERNAME}</username>
            <password>${env.CENTRAL_TOKEN_PASSWORD}</password>
        </server>
        
        <!-- GitHub Packages (optionnel) -->
        <server>
            <id>github</id>
            <username>${env.GITHUB_USERNAME}</username>
            <password>${env.GITHUB_TOKEN}</password>
        </server>
        
        <!-- GPG Configuration -->
        <server>
            <id>gpg.passphrase</id>
            <passphrase>${env.GPG_PASSPHRASE}</passphrase>
        </server>
    </servers>

    <!-- Profils -->
    <profiles>
        <!-- Profil pour Central Portal -->
        <profile>
            <id>central</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <!-- Configuration GPG -->
                <gpg.executable>gpg</gpg.executable>
                <gpg.keyname>${env.GPG_KEY_ID}</gpg.keyname>
                <gpg.passphrase>${env.GPG_PASSPHRASE}</gpg.passphrase>
                <gpg.defaultKeyring>false</gpg.defaultKeyring>
                <gpg.useagent>true</gpg.useagent>
                <gpg.lockMode>never</gpg.lockMode>
                
                <!-- Configuration Central Portal -->
                <central.baseUrl>https://central.sonatype.com</central.baseUrl>
                <central.snapshotsUrl>https://central.sonatype.com</central.snapshotsUrl>
            </properties>
            
            <!-- Repositories -->
            <repositories>
                <repository>
                    <id>central</id>
                    <url>https://repo1.maven.org/maven2</url>
                    <releases>
                        <enabled>true</enabled>
                    </releases>
                    <snapshots>
                        <enabled>false</enabled>
                    </snapshots>
                </repository>
            </repositories>
            
            <pluginRepositories>
                <pluginRepository>
                    <id>central</id>
                    <url>https://repo1.maven.org/maven2</url>
                    <releases>
                        <enabled>true</enabled>
                    </releases>
                    <snapshots>
                        <enabled>false</enabled>
                    </snapshots>
                </pluginRepository>
            </pluginRepositories>
        </profile>
        
        <!-- Profil de développement local -->
        <profile>
            <id>development</id>
            <properties>
                <skipTests>false</skipTests>
                <maven.test.skip>false</maven.test.skip>
                <maven.javadoc.skip>true</maven.javadoc.skip>
                <gpg.skip>true</gpg.skip>
            </properties>
        </profile>
        
        <!-- Profil pour CI/CD -->
        <profile>
            <id>ci</id>
            <properties>
                <skipTests>false</skipTests>
                <maven.test.skip>false</maven.test.skip>
                <maven.javadoc.skip>false</maven.javadoc.skip>
                <gpg.skip>false</gpg.skip>
                <jacoco.skip>false</jacoco.skip>
            </properties>
        </profile>
        
        <!-- Profil de release avec auto-publish -->
        <profile>
            <id>release-auto</id>
            <properties>
                <central.autoPublish>true</central.autoPublish>
                <central.waitUntil>published</central.waitUntil>
            </properties>
        </profile>
        
        <!-- Profil de release manuel -->
        <profile>
            <id>release-manual</id>
            <properties>
                <central.autoPublish>false</central.autoPublish>
                <central.waitUntil>validated</central.waitUntil>
            </properties>
        </profile>
    </profiles>

    <!-- Profils actifs -->
    <activeProfiles>
        <activeProfile>central</activeProfile>
        <activeProfile>development</activeProfile>
    </activeProfiles>

    <!-- Miroirs pour optimiser les téléchargements -->
    <mirrors>
        <!-- Bloquer HTTP pour forcer HTTPS -->
        <mirror>
            <id>maven-default-http-blocker</id>
            <mirrorOf>external:http:*</mirrorOf>
            <name>Pseudo repository to mirror external repositories initially using HTTP.</name>
            <url>http://0.0.0.0/</url>
        </mirror>
    </mirrors>

    <!-- Configuration locale -->
    <localRepository>${user.home}/.m2/repository</localRepository>
    <interactiveMode>false</interactiveMode>
    <offline>false</offline>

</settings>
